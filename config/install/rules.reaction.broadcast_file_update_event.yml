d: 129d52bf-c67f-41fc-81fc-83f126f59a66
langcode: en
status: true
dependencies:
  enforced:
    module:
      - islandora
id: broadcast_file_update_event
label: 'Broadcast File Update Event'
events:
  -
    event_name: 'rules_entity_update:file'
description: 'Broadcasts an AS2 event to a message broker when a File is updated.'
tags:
  - ''
config_version: '3'
expression:
  id: rules_rule
  uuid: 5355a324-0af0-48bb-8168-e2810a9ee0a2
  conditions:
    id: rules_and
    uuid: 0b266024-65ea-4e91-b0e6-ae88b8bfd5ed
    conditions: {  }
  actions:
    id: rules_action_set
    uuid: 85a784ad-7f03-4ba9-8c01-f87f33f15d5e
    actions:
      -
        id: rules_action
        uuid: a7dcf8e2-7e2d-4c9b-b658-e4f3f28898a1
        context_values: {  }
        context_mapping:
          entity: file
          user: '@user.current_user_context:current_user'
        context_processors: {  }
        provides_mapping: {  }
        action_id: islandora_update_event_generator
      -
        id: rules_action
        uuid: 60aa1b60-9ea4-40d1-bfbf-d036a617179a
        context_values:
          recipients:
            - 'activemq:queue:islandora-indexing-fcrepo-file'
        context_mapping:
          message: event_message
        context_processors:
          recipients:
            rules_tokens: {  }
        provides_mapping: {  }
        action_id: islandora_broadcast
